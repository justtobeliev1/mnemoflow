# Mnemoflow API ç«¯ç‚¹æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº† Mnemoflow è®¤çŸ¥ç§‘å­¦è‹±è¯­è¯æ±‡å­¦ä¹ åº”ç”¨çš„æ‰€æœ‰ API ç«¯ç‚¹ã€‚æ‰€æœ‰ API éƒ½é‡‡ç”¨å‡½æ•°å¼æ¶æ„è®¾è®¡ï¼Œä½¿ç”¨å‚æ•°æ³¨å…¥æ¨¡å¼ï¼Œå¹¶é›†æˆäº†ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œ Zod éªŒè¯ã€‚

## è®¤è¯è¯´æ˜

é™¤äº†å…¬å¼€ç«¯ç‚¹å¤–ï¼Œæ‰€æœ‰ API éƒ½éœ€è¦ç”¨æˆ·è®¤è¯ã€‚è®¤è¯é€šè¿‡ Supabase çš„ JWT token è¿›è¡ŒéªŒè¯ã€‚

## API ç«¯ç‚¹åˆ—è¡¨

### ğŸ‘¤ ç”¨æˆ·èµ„æ–™ç®¡ç†

#### 1. è·å–ç”¨æˆ·èµ„æ–™
- **ç«¯ç‚¹**: `GET /api/me/profile`
- **åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„èµ„æ–™ä¿¡æ¯
- **è®¤è¯**: å¿…é¡»
- **å“åº”**: ç”¨æˆ·èµ„æ–™å¯¹è±¡
- **å®ç°æ–‡ä»¶**: `src/app/api/me/profile/route.ts`
- **æœåŠ¡å±‚**: `src/services/profile.service.ts`

#### 2. æ›´æ–°ç”¨æˆ·èµ„æ–™
- **ç«¯ç‚¹**: `PATCH /api/me/profile`
- **åŠŸèƒ½**: æ›´æ–°ç”¨æˆ·èµ„æ–™ä¿¡æ¯
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**: ç”¨æˆ·èµ„æ–™æ›´æ–°æ•°æ® (Zod éªŒè¯)
- **å“åº”**: æ›´æ–°åçš„ç”¨æˆ·èµ„æ–™
- **å®ç°æ–‡ä»¶**: `src/app/api/me/profile/route.ts`
- **éªŒè¯å™¨**: `src/lib/validators/profile.schemas.ts`

### ğŸ“š å•è¯æœ¬ç®¡ç†

#### 7. è·å–å•è¯æœ¬åˆ—è¡¨
- **ç«¯ç‚¹**: `GET /api/me/word-lists`
- **åŠŸèƒ½**: è·å–ç”¨æˆ·çš„æ‰€æœ‰å•è¯æœ¬
- **è®¤è¯**: å¿…é¡»
- **æŸ¥è¯¢å‚æ•°**: 
  - `page` (å¯é€‰): é¡µç ï¼Œé»˜è®¤ 1
  - `limit` (å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 10ï¼Œæœ€å¤§ 50
- **å“åº”**: åˆ†é¡µçš„å•è¯æœ¬åˆ—è¡¨
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/route.ts`
- **æœåŠ¡å±‚**: `src/services/word-list.service.ts`

#### 8. åˆ›å»ºå•è¯æœ¬
- **ç«¯ç‚¹**: `POST /api/me/word-lists`
- **åŠŸèƒ½**: åˆ›å»ºæ–°çš„å•è¯æœ¬
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**: å•è¯æœ¬åˆ›å»ºæ•°æ® (Zod éªŒè¯)
- **å“åº”**: åˆ›å»ºçš„å•è¯æœ¬å¯¹è±¡
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/route.ts`
- **éªŒè¯å™¨**: `src/lib/validators/word-list.schemas.ts`

#### 9. è·å–å•è¯æœ¬è¯¦æƒ…
- **ç«¯ç‚¹**: `GET /api/me/word-lists/{listId}`
- **åŠŸèƒ½**: è·å–æŒ‡å®šå•è¯æœ¬çš„è¯¦ç»†ä¿¡æ¯å’ŒåŒ…å«çš„å•è¯
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `listId` - å•è¯æœ¬ID
- **å“åº”**: å•è¯æœ¬è¯¦æƒ…å’Œå•è¯åˆ—è¡¨
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/[listId]/route.ts`

#### 10. æ›´æ–°å•è¯æœ¬
- **ç«¯ç‚¹**: `PATCH /api/me/word-lists/{listId}`
- **åŠŸèƒ½**: æ›´æ–°å•è¯æœ¬ä¿¡æ¯ï¼ˆå¦‚åç§°ï¼‰
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `listId` - å•è¯æœ¬ID
- **è¯·æ±‚ä½“**: å•è¯æœ¬æ›´æ–°æ•°æ® (Zod éªŒè¯)
- **å“åº”**: æ›´æ–°åçš„å•è¯æœ¬
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/[listId]/route.ts`

#### 11. åˆ é™¤å•è¯æœ¬
- **ç«¯ç‚¹**: `DELETE /api/me/word-lists/{listId}`
- **åŠŸèƒ½**: åˆ é™¤æŒ‡å®šå•è¯æœ¬ï¼›ä¿ç•™å­¦ä¹ è¿›åº¦ï¼Œä»…å°†ç›¸å…³ `user_word_progress.word_list_id` ç½®ä¸º `NULL`
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `listId` - å•è¯æœ¬ID
- **å“åº”**: åˆ é™¤ç¡®è®¤
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/[listId]/route.ts`

#### 12. è·å–å•è¯æœ¬è¯¦æƒ…ï¼ˆæŒ‰åç§°ï¼‰
- **ç«¯ç‚¹**: `GET /api/me/word-lists/by-name/{name}`
- **åŠŸèƒ½**: æ ¹æ®å•è¯æœ¬çš„**ç²¾ç¡®åç§°**æŸ¥è¯¢å•ä¸ªå•è¯æœ¬è¯¦ç»†ä¿¡æ¯ã€‚
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `name` - éœ€è¦è¿›è¡Œ URL ç¼–ç çš„å•è¯æœ¬åç§°ã€‚
- **å“åº”**: `200 OK` è¿”å›åŒ¹é…å¯¹è±¡ï¼›`404 Not Found` æœªæ‰¾åˆ°ã€‚
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/by-name/[name]/route.ts`

#### 13. è·å–å¸¦å­¦ä¹ ç»Ÿè®¡çš„å•è¯æœ¬åˆ—è¡¨ï¼ˆNEWï¼‰
- **ç«¯ç‚¹**: `GET /api/me/word-lists/with-stats`
- **åŠŸèƒ½**: è°ƒç”¨æ•°æ®åº“å‡½æ•° `get_word_lists_with_stats`ï¼Œè¿”å›æ‰€æœ‰**åŒ…å«æœªå­¦ä¹ æ–°è¯**çš„å•è¯æœ¬åŠå…¶å­¦ä¹ è¿›åº¦ç»Ÿè®¡ã€‚
- **è®¤è¯**: å¿…é¡»
- **å“åº”**:
```json
  [
    {
      "list_id": 1,
      "list_name": "é›…æ€æ ¸å¿ƒè¯æ±‡",
      "total_words": 250,
      "learned_words": 150,
      "new_words": 100
    }
  ]
```
- **å®ç°æ–‡ä»¶**: `src/app/api/me/word-lists/with-stats/route.ts`
- **æ•°æ®åº“å‡½æ•°**: `public.get_word_lists_with_stats(p_user_id uuid)`

### ğŸ“ è¯æ±‡ç®¡ç†

#### 12. æ”¶å½•å•è¯
- **ç«¯ç‚¹**: `POST /api/me/words`
- **åŠŸèƒ½**: å°†å•è¯æ”¶å½•åˆ°ç”¨æˆ·çš„å­¦ä¹ åˆ—è¡¨
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**: å•è¯æ”¶å½•æ•°æ® (Zod éªŒè¯)
  - `word_id`: å•è¯ID
  - `list_id` (å¯é€‰): ç›®æ ‡å•è¯æœ¬IDï¼Œé»˜è®¤ä½¿ç”¨ç”¨æˆ·é»˜è®¤å•è¯æœ¬
- **å“åº”**: åˆ›å»ºçš„å­¦ä¹ è¿›åº¦è®°å½•
- **å®ç°æ–‡ä»¶**: `src/app/api/me/words/route.ts`
- **æœåŠ¡å±‚**: `src/services/word.service.ts`
- **éªŒè¯å™¨**: `src/lib/validators/word.schemas.ts`

#### 13. ç§»é™¤å•è¯
- **ç«¯ç‚¹**: `DELETE /api/me/words/{wordId}`
- **åŠŸèƒ½**: ä»ç”¨æˆ·å­¦ä¹ åˆ—è¡¨ä¸­ç§»é™¤å•è¯
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `wordId` - å•è¯ID
- **å“åº”**: åˆ é™¤ç¡®è®¤
- **å®ç°æ–‡ä»¶**: `src/app/api/me/words/[wordId]/route.ts`

#### 14. ç§»åŠ¨å•è¯
- **ç«¯ç‚¹**: `PATCH /api/me/words/{wordId}`
- **åŠŸèƒ½**: å°†å•è¯ç§»åŠ¨åˆ°å…¶ä»–å•è¯æœ¬
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `wordId` - å•è¯ID
- **è¯·æ±‚ä½“**: ç§»åŠ¨æ•°æ® (Zod éªŒè¯)
  - `new_list_id`: æ–°å•è¯æœ¬ID
- **å“åº”**: æ›´æ–°åçš„å­¦ä¹ è¿›åº¦è®°å½•
- **å®ç°æ–‡ä»¶**: `src/app/api/me/words/[wordId]/route.ts`

#### 20. è·å–å•è¯æ”¶è—çŠ¶æ€
- **ç«¯ç‚¹**: `GET /api/me/words/{wordId}`
- **åŠŸèƒ½**: è·å–æŒ‡å®šå•è¯åœ¨ `user_word_progress` ä¸­å½“å‰å½’å±çš„å•è¯æœ¬ IDï¼ˆ`word_list_id`ï¼‰
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `wordId` - å•è¯ID
- **å“åº”**: `{ word_list_id: number | null }`
- **å®ç°æ–‡ä»¶**: `src/app/api/me/words/[wordId]/route.ts`

#### 3. è·å–æœç´¢å†å²
- **ç«¯ç‚¹**: `GET /api/me/search-history`
- **åŠŸèƒ½**: è·å–ç”¨æˆ·çš„å•è¯æœç´¢å†å²
- **è®¤è¯**: å¿…é¡»
- **æŸ¥è¯¢å‚æ•°**:
  - `limit` (å¯é€‰): è¿”å›ç»“æœæ•°é‡ï¼Œé»˜è®¤ 20ï¼Œæœ€å¤§ 100
- **å“åº”**: æœç´¢å†å²è®°å½•åˆ—è¡¨
- **å®ç°æ–‡ä»¶**: `src/app/api/me/search-history/route.ts`

#### 4. æœç´¢å•è¯ âš ï¸ è·¯å¾„å·²æ›´æ–°
- **ç«¯ç‚¹**: `GET /api/words/search/{searchTerm}`
- **åŠŸèƒ½**: æ ¹æ®æœç´¢è¯æŸ¥è¯¢å•è¯ä¿¡æ¯ï¼Œæ”¯æŒå¼‚æ­¥åŠ è½½
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `searchTerm` - æœç´¢çš„å•è¯ (URLç¼–ç )
- **å“åº”**: å•è¯ä¿¡æ¯æˆ–404
- **ç‰¹æ€§**: è‡ªåŠ¨è®°å½•æœç´¢å†å²
- **å®ç°æ–‡ä»¶**: `src/app/api/words/search/[searchTerm]/route.ts`
- **æ³¨æ„**: æ­¤ç«¯ç‚¹è·¯å¾„å·²ä» `/api/words/{searchTerm}` æ›´æ–°ä¸º `/api/words/search/{searchTerm}` ä»¥è§£å†³è·¯ç”±å†²çª

### ğŸ”„ å¤ä¹ ç³»ç»Ÿ (FSRS ç®—æ³•)

#### 15. è·å–å¤ä¹ é˜Ÿåˆ— âš ï¸ DEPRECATEDï¼ˆæ­¤ç«¯å£å·²ç»å¼ƒç”¨ï¼Œè¯·æ”¹ç”¨ `GET /api/me/review/session`ï¼‰
- **ç«¯ç‚¹**: `GET /api/me/review/queue`
- **åŠŸèƒ½**: è·å–ç”¨æˆ·çš„å¤ä¹ é˜Ÿåˆ—å’Œç»Ÿè®¡ä¿¡æ¯ï¼ˆæ—§æ¨¡å¼ï¼Œå‰ç«¯éœ€å†è¯·æ±‚é¢˜ç›®ä¸é€‰é¡¹ï¼‰
- **è®¤è¯**: å¿…é¡»
- **æŸ¥è¯¢å‚æ•°**:
  - `limit` (å¯é€‰): è¿”å›ç»“æœæ•°é‡ï¼Œé»˜è®¤ 20ï¼Œæœ€å¤§ 100
  - `due_before` (å¯é€‰): åªè¿”å›æŒ‡å®šæ—¶é—´ä¹‹å‰åˆ°æœŸçš„å•è¯
- **å“åº”**: å¤ä¹ é˜Ÿåˆ—å’Œç»Ÿè®¡ä¿¡æ¯
- **å®ç°æ–‡ä»¶**: `src/app/api/me/review/queue/route.ts`
- **æœåŠ¡å±‚**: `src/services/review.service.ts`
- **éªŒè¯å™¨**: `src/lib/validators/review.schemas.ts`

#### 16. æ›´æ–°å­¦ä¹ è¿›åº¦ âš ï¸ DEPRECATEDï¼ˆæ­¤ç«¯å£å·²ç»å¼ƒç”¨ï¼Œè¯·æ”¹ç”¨ `POST /api/me/quiz/submit`ï¼‰
- **ç«¯ç‚¹**: `PATCH /api/me/review/progress/{wordId}`
- **åŠŸèƒ½**: æ ¹æ®å¤ä¹ ç»“æœæ›´æ–°å•è¯çš„å­¦ä¹ è¿›åº¦ (FSRS ç®—æ³•)
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `wordId` - å•è¯ID
- **è¯·æ±‚ä½“**: å¤ä¹ ç»“æœæ•°æ® (Zod éªŒè¯)
  - `rating`: å¤ä¹ è¯„çº§ ('again', 'hard', 'good', 'easy')
  - `review_time` (å¯é€‰): å¤ä¹ æ—¶é—´
- **å“åº”**: æ›´æ–°åçš„å­¦ä¹ è¿›åº¦
- **å®ç°æ–‡ä»¶**: `src/app/api/me/review/progress/[wordId]/route.ts`

#### 21. è·å–å¤ä¹ ä¼šè¯ï¼ˆNEWï¼‰
- **ç«¯ç‚¹**: `GET /api/me/review/session`
- **åŠŸèƒ½**: ä¸€æ¬¡æ€§è¿”å›æ•´åœºå¤ä¹ ä¼šè¯ï¼ˆä¾‹å¦‚ 20 å¥—é¢˜ï¼‰ã€‚åç«¯è°ƒç”¨æ•°æ®åº“ RPC `generate_review_session(userId, limit)` ç”Ÿæˆé¢˜ç›®åŠ 3 ä¸ªå¹²æ‰°é¡¹å¹¶æ‰“ä¹±é¡ºåºã€‚
- **è®¤è¯**: å¿…é¡»
- **æŸ¥è¯¢å‚æ•°**:
  - `limit` (å¯é€‰): æ¯æ¬¡è¿”å›çš„é¢˜ç›®æ•°é‡ï¼Œé»˜è®¤ 20ï¼Œæœ€å¤§ 100
- **å“åº”**: ä¼šè¯ JSON

ç¤ºä¾‹ï¼š
```json
{
  "quizzes": [
    {
      "quiz_word_id": 123,
      "options": [
        { "word_id": 123, "word": "abandon", "definition": "v. æ”¾å¼ƒ" },
        { "word_id": 45,  "word": "ability", "definition": "n. èƒ½åŠ›" },
        { "word_id": 678, "word": "band",    "definition": "n. ä¹é˜Ÿ" },
        { "word_id": 910, "word": "ban",     "definition": "v. ç¦æ­¢" }
      ]
    }
  ]
}
```
- **å®ç°æ–‡ä»¶**: `src/app/api/me/review/session/route.ts`
- **æ•°æ®åº“å‡½æ•°**: `public.generate_review_session(p_user_id uuid, p_limit int)`

#### 22. æäº¤æµ‹éªŒç»“æœï¼ˆNEWï¼ŒæœåŠ¡å™¨ç«¯ FSRS è®¡ç®—ï¼‰
- **ç«¯ç‚¹**: `POST /api/me/quiz/submit`
- **åŠŸèƒ½**: åŸå­åŒ–å¤„ç†ä¸€æ¬¡ä½œç­”ï¼šåç«¯è¯»å– `user_word_progress` çš„æ—§çŠ¶æ€å¹¶è°ƒç”¨ [`ts-fsrs`](https://www.npmjs.com/package/ts-fsrs) è®¡ç®—æ–°çŠ¶æ€ï¼Œå°†åŒ…å« `reps` ä¸ `scheduled_days` åœ¨å†…çš„æ‰€æœ‰å­—æ®µå†™å›æ•°æ®åº“ã€‚
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**:
```json
{
  "quiz_word_id": 123,
  "rating": "good"  // one of again|hard|good|easy
}
```
- **å“åº”**:
```json
{
  "updated_progress": {
    "word_id": 123,
    "due": "2025-09-17T12:00:00Z",
    "stability": 6.75,
    "difficulty": 4.8,
    "state": 2,
    "last_review": "2025-09-16T12:00:00Z",
    "reps": 10,
    "scheduled_days": 5
  }
}
```
- **å®ç°æ–‡ä»¶**: `src/app/api/me/quiz/submit/route.ts`
- **æœåŠ¡å±‚**: `src/services/review.service.ts` â†’ `submitQuizAnswerAndUpdateProgress`
- **ä¾èµ–**: `ts-fsrs`ï¼ˆä½¿ç”¨ `fsrs().repeat(card, now)` å¹¶æ ¹æ®ç”¨æˆ·è¯„çº§å–å¯¹åº” `card`ï¼Œå†è½åº“ï¼‰

> è¯´æ˜ï¼šæ—§çš„ `PATCH /api/me/review/progress/{wordId}` å·²åºŸå¼ƒã€‚è¯·å…¨éƒ¨æ”¹ç”¨ `POST /api/me/quiz/submit`ã€‚

#### 23. è·å–åˆ°æœŸå¤ä¹ æ¸…å•ï¼ˆNEWï¼‰
- ç«¯ç‚¹: `GET /api/me/reviews/due-list`
- åŠŸèƒ½: è°ƒç”¨æ•°æ®åº“å‡½æ•° `public.get_due_reviews(user_id, limit)`ï¼Œè¿”å›æ‰€æœ‰ `due <= NOW()` çš„å•è¯ï¼ŒæŒ‰åˆ°æœŸæ—¶é—´å‡åºã€‚
- è®¤è¯: å¿…é¡»
- æŸ¥è¯¢å‚æ•°:
  - `limit` (å¯é€‰): è¿”å›æ•°é‡ä¸Šé™ï¼Œé»˜è®¤ 100ï¼Œæœ€å¤§ 500
- å“åº”:
```json
{
  "reviews": [
    { "word_id": 1, "word": "abandon", "compressed_definition": "v. æ”¾å¼ƒ", "due": "2025-09-19T12:00:00Z", "stability": 6.7, "difficulty": 4.8 }
  ]
}
```
- å®ç°æ–‡ä»¶: `src/app/api/me/reviews/due-list/route.ts`
- æ•°æ®åº“å‡½æ•°: `public.get_due_reviews(p_user_id uuid, p_limit int)`

### ğŸ§  AI åŠ©è®°åŠŸèƒ½

#### 5. è·å–åŠ©è®°å†…å®¹
- **ç«¯ç‚¹**: `GET /api/mnemonics/{wordId}`
- **åŠŸèƒ½**: è·å–å•è¯çš„AIç”ŸæˆåŠ©è®°å†…å®¹ï¼Œæ”¯æŒè½®è¯¢æœºåˆ¶
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `wordId` - å•è¯ID
- **æŸ¥è¯¢å‚æ•°**:
  - `timeout` (å¯é€‰): è½®è¯¢è¶…æ—¶æ—¶é—´(æ¯«ç§’)ï¼Œé»˜è®¤ 30000ï¼Œæœ€å¤§ 60000
- **å“åº”**: 
  - 200: åŠ©è®°å†…å®¹å·²å®Œæˆï¼ˆåŒ…å« `id` ä¸ `version`ï¼‰
  - 202: å†…å®¹æ­£åœ¨ç”Ÿæˆä¸­ï¼ˆå½“ `{ content.status: 'generating' }` æ—¶è¿”å›ï¼‰
  - 404: åŠ©è®°å†…å®¹ä¸å­˜åœ¨
- **å®ç°æ–‡ä»¶**: `src/app/api/mnemonics/[wordId]/route.ts`
- **æœåŠ¡å±‚**: `src/services/mnemonic.service.ts`
- **éªŒè¯å™¨**: `src/lib/validators/mnemonic.schemas.ts`

#### 6. é‡æ–°ç”ŸæˆåŠ©è®°å†…å®¹ï¼ˆæ’å…¥æ–°ç‰ˆæœ¬ï¼‰
- **ç«¯ç‚¹**: `PUT /api/mnemonics/{wordId}`
- **åŠŸèƒ½**: é‡æ–°ç”Ÿæˆå•è¯çš„åŠ©è®°å†…å®¹ã€‚æ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ’å…¥æ–°ç‰ˆæœ¬ï¼ˆ`version+1`ï¼‰ï¼Œå†å²ç‰ˆæœ¬ä¿ç•™ã€‚
- **è®¤è¯**: å¿…é¡»
- **è·¯å¾„å‚æ•°**: `wordId` - å•è¯ID
- **è¯·æ±‚ä½“** (å¯é€‰): é‡æ–°ç”Ÿæˆå‚æ•°
  - `type` (å¯é€‰): åŠ©è®°ç±»å‹ ('story', 'association', 'visual', 'phonetic')
  - `user_context` (å¯é€‰): ç”¨æˆ·ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆâ€œè¿½åŠ è¦æ±‚â€å†…å®¹ï¼‰
#### 6.1 åŠ©è®°åé¦ˆ
- **ç«¯ç‚¹ A**: `POST /api/mnemonics/{wordId}/feedback`
- **åŠŸèƒ½**: æäº¤åé¦ˆï¼Œå¹‚ç­‰å†™å…¥ï¼ˆ`upsert` on `(user_id, word_mnemonic_id)`ï¼‰
- **è¯·æ±‚ä½“**: `{ rating: 1|-1, mnemonicId?: number }`ï¼ˆæ¨èä¼  `mnemonicId` ç»‘å®šåˆ°å…·ä½“ç‰ˆæœ¬ï¼Œå¦åˆ™é»˜è®¤æœ€æ–°ç‰ˆæœ¬ï¼‰
- **å“åº”**: 201
- **ç«¯ç‚¹ B**: `GET /api/mnemonics/{wordId}/feedback?mnemonicId=...`
- **åŠŸèƒ½**: è¯»å–å½“å‰ç”¨æˆ·å¯¹è¯¥ç‰ˆæœ¬æ˜¯å¦å·²åé¦ˆï¼ˆæ¢å¤â€œå·²æäº¤â€ï¼‰
- **å“åº”**: `{ exists: boolean, rating?: 1|-1 }`
- **å“åº”**: é‡æ–°ç”Ÿæˆä»»åŠ¡ç¡®è®¤
- **å®ç°æ–‡ä»¶**: `src/app/api/mnemonics/[wordId]/route.ts`

### ğŸ’¬ AI èŠå¤©åŠŸèƒ½ï¼ˆå·²æ›¿æ¢å®ç°ï¼‰

#### 18. AI é—®ç­”ï¼ˆSSE æµå¼ï¼‰
- **ç«¯ç‚¹**: `POST /api/ai/chat`
- **åŠŸèƒ½**: å‘å¤§æ¨¡å‹å‘é€ Promptï¼ŒæŒ‰ç‰‡æ®µæµå¼è¿”å› Markdown å›ç­”
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**:
  - `word`: string   // å½“å‰å­¦ä¹ å•è¯ï¼ˆç”¨äºç³»ç»Ÿæç¤ºè¯ï¼‰
  - `prompt`: string // ç”¨æˆ·é—®é¢˜
- **å“åº”**: `text/event-stream`ï¼ˆSSEï¼‰ï¼ŒæŒç»­è¿”å›æ–‡æœ¬ç‰‡æ®µ
- **å¤±è´¥**: ç›´æ¥é€ä¼ ä¸Šæ¸¸é”™è¯¯ï¼ˆå½¢å¦‚ `{ error: { code, status, model, body } }`ï¼‰
- **å®ç°æ–‡ä»¶**: `src/app/api/ai/chat/route.ts`
- **ç¯å¢ƒå˜é‡**ï¼ˆ.env.localï¼‰:
  - `DASHSCOPE_API_KEY`: é˜¿é‡Œäº‘ç™¾ç‚¼ API Keyï¼ˆå¿…å¡«ï¼‰
  - `DASHSCOPE_MODEL_ID`: æ¨¡å‹ IDï¼ˆå¦‚ `qwen2.5-7b-instruct-1m`ï¼Œå¿…å¡«ï¼‰
  - `DASHSCOPE_BASE_URL`: å¯é€‰ï¼Œé»˜è®¤ `https://dashscope.aliyuncs.com`

#### 19. å•è¯ä¼šè¯å†å²ï¼ˆè·å–/ä¿å­˜ï¼‰
- **ç«¯ç‚¹ A**: `GET /api/me/chat-history`
- **åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·åœ¨æŸä¸ªå•è¯ä¸‹çš„æ•´æ®µèŠå¤©å†å²
- **è®¤è¯**: å¿…é¡»
- **æŸ¥è¯¢å‚æ•°**:
  - `wordId`: number // å•è¯ID
- **å“åº”**: `{ conversation_log: Array<{ role: 'user'|'assistant', content: string }> }` æˆ–ç©ºå¯¹è±¡
- **ç«¯ç‚¹ B**: `POST /api/me/chat-history`
- **åŠŸèƒ½**: ä¿å­˜æ•´æ®µèŠå¤©å†å²ï¼ˆä¸å­˜åœ¨åˆ™æ’å…¥ï¼Œå­˜åœ¨åˆ™æ›´æ–°ï¼‰
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**:
  - `wordId`: number
  - `messages`: Array<{ role: 'user'|'assistant', content: string }>
- **å®ç°æ–‡ä»¶**: `src/app/api/me/chat-history/route.ts`
- **æœåŠ¡å±‚**: `src/services/chat.service.ts`
- **è¯´æ˜**: è¡¨ç»“æ„ `word_chat_history(user_id, word_id, conversation_log, updated_at)`ï¼›RLS é™åˆ¶ç”¨æˆ·ä»…èƒ½è¯»å†™è‡ªå·±çš„å†å²ï¼›æœåŠ¡å±‚é‡‡ç”¨â€œå…ˆæŸ¥â†’å­˜åœ¨åˆ™æ›´æ–°ï¼Œå¦åˆ™æ’å…¥â€çš„ä¸¤æ®µå¼ä¿å­˜é€»è¾‘ã€‚

### ğŸ“¢ åé¦ˆç³»ç»Ÿ

#### 17. æäº¤åé¦ˆ
- **ç«¯ç‚¹**: `POST /api/feedback`
- **åŠŸèƒ½**: ç”¨æˆ·æäº¤bugæŠ¥å‘Šã€åŠŸèƒ½è¯·æ±‚ç­‰åé¦ˆ
- **è®¤è¯**: å¿…é¡»
- **è¯·æ±‚ä½“**: åé¦ˆæ•°æ® (Zod éªŒè¯)
  - `type`: åé¦ˆç±»å‹ ('bug', 'feature', 'improvement', 'other')
  - `title`: åé¦ˆæ ‡é¢˜
  - `content`: åé¦ˆè¯¦ç»†å†…å®¹
  - `priority` (å¯é€‰): ä¼˜å…ˆçº§ï¼Œé»˜è®¤ 'medium'
  - `contact_email` (å¯é€‰): è”ç³»é‚®ç®±
- **å“åº”**: åˆ›å»ºçš„åé¦ˆè®°å½•
- **å®ç°æ–‡ä»¶**: `src/app/api/feedback/route.ts`
- **æœåŠ¡å±‚**: `src/services/feedback.service.ts`
- **éªŒè¯å™¨**: `src/lib/validators/feedback.schemas.ts`

## æŠ€æœ¯æ¶æ„ç‰¹ç‚¹

### ğŸ—ï¸ å‡½æ•°å¼æ¶æ„
- **å‚æ•°æ³¨å…¥æ¨¡å¼**: æ‰€æœ‰æœåŠ¡å‡½æ•°æ¥æ”¶ `{ supabase, userId }` å‚æ•°
- **çº¯å‡½æ•°è®¾è®¡**: æœåŠ¡å±‚å‡½æ•°æ— çŠ¶æ€ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤
- **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ä½¿ç”¨ `handleApiError` ç»Ÿä¸€å¤„ç†æ‰€æœ‰APIé”™è¯¯
  - æœåŠ¡ç«¯è¿”å›ç»“æ„åŒ–é”™è¯¯ç  `error_code`ï¼Œç¤ºä¾‹ï¼š`WORDLIST_NAME_CONFLICT`
  - å‰ç«¯åŸºäºé”™è¯¯ç å±•ç¤ºå®šåˆ¶åŒ–æ–‡æ¡ˆä¸å›é€€ï¼ˆå¯¹è¯æ¡†ä¿æŒ/å¤å¼€ï¼‰

### ğŸ”’ ç±»å‹å®‰å…¨
- **Zod éªŒè¯**: æ‰€æœ‰è¾“å…¥æ•°æ®éƒ½ç»è¿‡ä¸¥æ ¼çš„è¿è¡Œæ—¶ç±»å‹éªŒè¯
- **TypeScript**: å®Œæ•´çš„ç±»å‹definitionå’Œç±»å‹æ¨å¯¼
- **Schema æ–‡ä»¶**: é›†ä¸­ç®¡ç†æ‰€æœ‰éªŒè¯è§„åˆ™

### ğŸš€ é«˜çº§åŠŸèƒ½
- **FSRS ç®—æ³•**: æ™ºèƒ½é—´éš”é‡å¤å­¦ä¹ ç®—æ³•
- **å¼‚æ­¥AIç”Ÿæˆ**: åŠ©è®°å†…å®¹å’ŒèŠå¤©å“åº”çš„å¼‚æ­¥ç”Ÿæˆ
- **è½®è¯¢æœºåˆ¶**: æ”¯æŒé•¿æ—¶é—´AIä»»åŠ¡çš„è½®è¯¢æŸ¥è¯¢
- **æœç´¢å†å²**: è‡ªåŠ¨è®°å½•ç”¨æˆ·æœç´¢è¡Œä¸º

## æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ app/api/                    # APIè·¯ç”±å®ç°
â”‚   â”œâ”€â”€ feedback/              # åé¦ˆç³»ç»Ÿ
â”‚   â”œâ”€â”€ me/                    # ç”¨æˆ·ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ profile/           # ç”¨æˆ·èµ„æ–™
â”‚   â”‚   â”œâ”€â”€ word-lists/        # å•è¯æœ¬ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ words/             # è¯æ±‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ search-history/    # æœç´¢å†å²
â”‚   â”‚   â””â”€â”€ review/            # å¤ä¹ ç³»ç»Ÿ
â”‚   â”œâ”€â”€ mnemonics/             # AIåŠ©è®°åŠŸèƒ½
â”‚   â””â”€â”€ words/                 # è¯æ±‡ç›¸å…³
â”‚       â”œâ”€â”€ search/            # å•è¯æœç´¢
â”‚       â””â”€â”€ (deprecated chats) # æ—§èŠå¤©è·¯ç”±å·²è¿”å› 410
â”œâ”€â”€ lib/validators/            # ZodéªŒè¯å™¨
â”‚   â”œâ”€â”€ profile.schemas.ts
â”‚   â”œâ”€â”€ word-list.schemas.ts
â”‚   â”œâ”€â”€ word.schemas.ts
â”‚   â”œâ”€â”€ review.schemas.ts
â”‚   â”œâ”€â”€ feedback.schemas.ts
â”‚   â”œâ”€â”€ mnemonic.schemas.ts
â”‚   â””â”€â”€ chat.schemas.ts
â””â”€â”€ services/                  # ä¸šåŠ¡é€»è¾‘å±‚
    â”œâ”€â”€ profile.service.ts
    â”œâ”€â”€ word-list.service.ts
    â”œâ”€â”€ word.service.ts
    â”œâ”€â”€ review.service.ts
    â”œâ”€â”€ feedback.service.ts
    â”œâ”€â”€ mnemonic.service.ts
    â””â”€â”€ chat.service.ts
```
---

**æ³¨æ„**: æ­¤æ–‡æ¡£ä¼šéšç€APIçš„æ›´æ–°è€ŒæŒç»­ç»´æŠ¤æ›´æ–°ã€‚å¦‚æœ‰ä»»ä½•APIå˜æ›´ï¼Œè¯·åŠæ—¶æ›´æ–°æ­¤æ–‡æ¡£ã€‚