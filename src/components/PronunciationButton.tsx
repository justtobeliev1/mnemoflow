'use client';

import { useState } from 'react';

interface PronunciationButtonProps {
  word: string;
  accent?: 'UK' | 'US';
  className?: string;
}

export function PronunciationButton({ 
  word, 
  accent = 'US',
  className = ''
}: PronunciationButtonProps) {
  const [speaking, setSpeaking] = useState(false);
  
  const handleSpeak = () => {
    // 检查浏览器支持
    if (!window.speechSynthesis || speaking) return;
    
    // 停止当前播放
    speechSynthesis.cancel();
    
    setSpeaking(true);
    
    const utterance = new SpeechSynthesisUtterance(word);
    utterance.lang = accent === 'UK' ? 'en-GB' : 'en-US';
    utterance.rate = 0.8;  // 稍慢一点，便于学习
    utterance.pitch = 1;
    utterance.volume = 1;
    
    utterance.onend = () => {
      setSpeaking(false);
    };
    
    utterance.onerror = () => {
      setSpeaking(false);
      console.error('语音播放失败');
    };
    
    try {
      speechSynthesis.speak(utterance);
    } catch (error) {
      setSpeaking(false);
      console.error('语音播放出错:', error);
    }
  };
  
  // 检查浏览器支持
  const isSupported = typeof window !== 'undefined' && 'speechSynthesis' in window;
  
  if (!isSupported) {
    return null; // 不支持的浏览器不显示按钮
  }
  
  return (
    <button
      onClick={handleSpeak}
      disabled={speaking}
      className={`p-2 text-foreground hover:text-primary transition-colors rounded-lg hover:bg-surface/30 ${speaking ? 'text-primary' : ''} ${className}`}
      title={`${accent}发音`}
      type="button"
    >
      {/* 播放图标SVG */}
      <svg 
        className={`w-5 h-5 ${speaking ? 'fill-primary' : 'fill-current'}`} 
        viewBox="0 0 1024 1024"
      >
        <path d="M597.362156 405.742954 597.216847 405.742954 597.381599 431.673533Z"/>
        <path d="M554.141988 94.405385c-12.009258-5.66356-26.244206-4.09982-36.687726 3.966111-0.479675 0.400928-51.280832 39.776232-107.332628 80.123077-97.557456 70.150238-125.982584 81.839313-131.72609 83.690258L169.836347 262.184831c-28.551042 0-53.58447 11.554366-70.580147 32.585907-14.628082 18.056558-22.362838 41.7399-22.362838 68.471776l0 297.515684c0 55.716624 46.352373 101.06168 103.37751 101.06168l42.835957 0c19.125633 0 34.659301-15.159522 34.659301-33.865439 0-18.668942-15.533468-33.807678-34.659301-33.807678L180.270872 694.14676c-18.762679 0-34.05591-15.007025-34.05591-33.387763L146.214962 363.242514c0-12.469945 3.074515-33.34879 23.622384-33.34879l110.864034 0c17.751564 0 45.016879-7.150352 163.878091-92.155119 21.231005-15.139535 41.895595-30.393993 59.819442-43.76033l0 631.296381c-14.437611-11.91732-30.538495-24.996652-46.993538-38.001235-108.679915-85.976908-115.633001-93.12746-133.86504-93.12746l0 0c-19.127631 0-34.6613 15.139735-34.6613 33.807678 0 17.732577 13.99771 32.261727 31.750273 33.711943 5.052175 1.734224 11.389878 13.080332 99.396209 83.172809 50.357458 40.080425 95.5748 79.225485 96.018499 79.591437 6.473211 5.623587 14.679847 8.540609 23.055968 8.540609 4.772964 0 9.624674-0.953553 14.149407-2.974983 12.459952-5.491077 20.471121-17.579881 20.471121-30.890656l0-774.228673C573.719514 111.852756 566.111273 100.011184 554.141988 94.405385L554.141988 94.405385 554.141988 94.405385 554.141988 94.405385zM910.546745 636.999306c23.939569-37.659067 36.562011-81.20994 36.562011-125.88485 0-44.713684-12.659417-88.264756-36.562011-125.905836-23.33338-36.685727-56.332007-66.316637-95.41231-85.612954-17.060233-8.428885-37.927285-1.774197-46.582617 14.891304-8.656331 16.704275-1.824963 37.048681 15.245264 45.476767 57.99448 28.659769 93.990075 86.568307 93.990075 151.151719s-35.995595 122.511137-93.951101 151.131933c-17.071426 8.464861-23.901595 28.812265-15.246263 45.476767 6.110257 11.765823 18.280006 18.572208 30.933427 18.572208 5.302605 0 10.643983-1.200786 15.658184-3.641131C854.214738 703.33693 887.213565 673.726006 910.546745 636.999306L910.546745 636.999306 910.546745 636.999306 910.546745 636.999306zM761.824179 516.476821l-0.168486 0c0.003997-0.262222 0.008994-0.523645 0.008994-0.787866 0-26.556395-7.380796-51.500283-20.307432-73.189977-4.315274-10.802476-15.343997-18.487465-28.27463-18.487465-16.688485 0-30.22051 12.797923-30.22051 28.586818 0 8.101907 3.56918 15.409952 9.2925 20.611625 6.067486 13.02337 9.447195 27.382235 9.447195 42.478999 0 0.529641-0.019986 1.055085-0.026982 1.581728l0.190471 0c0.005996 0.262222 0.013991 0.523645 0.013991 0.786867 0 15.097764-3.379709 29.456429-9.447195 42.479799-5.72332 5.201873-9.2925 12.510718-9.2925 20.610626 0 15.787896 13.531026 28.587817 30.22051 28.587817 12.930633 0 23.958556-7.68499 28.27463-18.486466 12.926636-21.689694 20.307432-46.633582 20.307432-73.189977C761.842167 517.530906 761.830175 517.004263 761.824179 516.476821z"/>
      </svg>
    </button>
  );
}