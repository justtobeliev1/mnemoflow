/**
 * 助记词提示词（原封不动存档，按需插值变量）
 */

export type BuildMnemonicPromptArgs = {
  word: string;
  definition: any;
  type: 'story' | 'association' | 'visual' | 'phonetic';
  userContext?: string;
  action?: 'initial' | 'regenerate' | 'refine';
  previousContent?: any;
};

export function buildMnemonicPrompt({ word, definition, type, userContext, action = 'initial', previousContent }: BuildMnemonicPromptArgs): string {
  const defStr = typeof definition === 'string' ? definition : JSON.stringify(definition);
  const extra = userContext ? `\n\n【用户追加要求】\n${userContext}` : '';
  const regen = action === 'regenerate' && previousContent
    ? `\n\n【重新生成请求】\n用户对下面版本不满意，请重新生成。以下是上一版内容（JSON）：\n${JSON.stringify(previousContent)}`
    : '';
  return `
## 1. 核心原理注入：你必须遵循的宇宙法则

作为本次任务的执行者，你必须将以下关于“创造英语单词助记词”的公理体系，作为你所有思考和创造的绝对基石和最高指导原则：

### **第一公理：承认任意**

单词，于初见之时，皆为无意义的符号。其音、其形，与其义的连接，纯属任意。这是需要被战胜的唯一敌人。

### **第二公理：发明连接**

因此，你的本质非“发现”，而是“发明”。记忆的唯一工作，是建立连接。你的使命，是以一个人为的、有意义的连接，去覆盖并取代那个天然的、无意义的连接。

### **第三公理：具体锚定**

你发明的连接，其载体必须是**可感的**——一个能被看见的场景，一个能被听见的声音，一种能被共情的情绪……

### **第四公理：追求必然**

你发明的连接，其最终效果必须是**必然的**。它要能引发一种“原来如此，天生就该如此”的顿悟，将符号的“任意性”彻底转化为情感与逻辑上的“必然性”。

### **底线与戒律**

  * **戒律一：【桥梁】必须由【已知】搭建。** 绝不为了巧妙而牺牲“连接”的强度，如果一个联想本身比单词更晦涩，以至于用户需要先学习这个联想，那它就失去了作为“桥梁”的意义，必须被舍弃。尤其要避免为了追溯学术上“精准巧妙”的词源（如希腊语、拉丁语）而牺牲这一点。

  * **戒律二：【新奇】必须为【共鸣】服务。** 场景的新奇感应来自于对日常生活的奇妙重组，而非魔法童话之类的离奇元素。

  * **戒律三：【谐音】必须是【配角】而非【主角】。** 警惕纯谐音捷径，它会切断字形与记忆的连接而无谓地增加了记忆的“交易成本”。

-----

## 2. 目标结果描述：你必须交付的“记忆场景”

你的最终交付物，不是一段简单的解释，而是一个能够在一个普通人脑海中，精准复现以下三种现象的【记忆场景】：

### **认知现象（啊哈！时刻）**

单词的音、形、义被一个巧妙的“钩子”瞬间打通，形成一个不可分割的、自洽的逻辑整体。

### **情感现象（心跳时刻）**

伴随“啊哈！”时刻，用户会体验到一次轻微但明确的情感冲击，如恰到好处的幽默、惊奇或共鸣。

### **影像现象（心理图钉）**

一个生动、动态的微型场景会自动在用户脑海中生成并“黏”在那里，挥之不去，不经意间被回想起。

-----

## 3. 执行指令：你的任务

现在，请将上述【核心原理】作为你的世界观，将【目标结果】作为你的靶心。

**解放思想，不拘一格**：自由地调用你知识库中任何维度的关联——文化、历史、数学、物理、网络迷因、生活常识……去寻找最意想不到、但又最合理的“钩子”。

**让单词本身引导你**：仔细“端详”给定的单词 \`${word}\`。它的发音有什么特点？它的字母组合在视觉上有什么奇特之处？抛开正统的词根词缀学，给定单词的拼写结构中，是否隐藏着可以被‘断章取义’并联想到具体事物的『小词』或『单词片段』？让单词自己告诉你，它最适合被如何“解锁”。

**开始创作**：为单词 \`${word}\` 设计并交付一个能完美达成上述所有要求的记忆方案。

**最终检验**：你的方案只有一个成功标准——它是否强大到足以让一个普通人将这个单词形态及其释义关联起来“一见钟情、过目不忘”？

**终极目标**：当用户再次遇见这个单词时，他们想到的不应是词典里干涩的释义，而是你为他们编织的那个独一无二的场景，让每个单词都成为一个有故事、有温度的老朋友。

-----

## 4. 交付规格(JSON格式)

你的最终交付物必须严格遵循以下JSON格式，只交付纯粹的、为用户学习而设计的助记内容。严禁输出任何关于“公理”、“现象”、“目标”等幕后思考过程的元数据，也严禁在JSON代码块前后添加任何说明性文字。你必须且只能输出一个严格遵循以下JSON格式的单一代码块。

【JSON结构说明】:
- \`word\`: (string) 目标单词
- \`meaning\`: (string) 核心词义
- \`blueprint\`: (object) 
  - \`title\`: (string) 固定为 "助记蓝图"
  - \`content\`: (string) [此处用最凝练的方式，揭示连接“单词形态”与“具体意象”的那个“啊哈”时刻的“机关”或“密钥”。它可以是一句公式、一段拆解、一句谐音，或任何形式的、能让用户恍然大悟的核心线索]
- \`scene\`: (object)
  - \`title\`: (string) 固定为 "记忆场景"
  - \`content\`: (string) [此处为生动、凝练地叙述将“灵感的火花”与“词义”融为一体的故事情节]
  - \`highlights\`: (array of strings)[一个字符串数组。数组中的每一个词，都是从\`blueprint.content\`中提炼出的、并在\`scene.content\`中**原样出现**的核心关键词，用于前端高亮，严格仿照下方案例的样式]
- \`example\`: (object) 
  - \`title\`: (string) 固定为 "点睛之笔"
  - \`sentence\`: (string)[提供一个能展现该单词精髓的例句，让用户看到这个“老朋友”在真实世界中是如何说话的]
  - \`translation\`: (string)[例句的中文翻译]

【JSON格式模板示例】:
\`\`\`json
{
  "word": "equivalent",
  "meaning": "相等的，等价的",
  "blueprint": {
    "title": "助记蓝图",
    "content": "equivalent ≈ equi(equal) - val(value) - ent(lent) → 借出(lent)的东西，其价值(value)是相等(equal)的。"
  },
  "scene": {
    "title": "记忆场景",
    "content": "想象你的朋友想借用(lent)你新买的相机，你有些犹豫。于是，他拿出自己价值几乎完全一样的手表作为抵押，并对你说：“你看，这块表的价值(value)和你的相机是相等(equal)的，我把它押在你这里，这样总公平了吧？” 你比较了一下，发现这两件物品确实在价值上是等同的。",
    "highlights": ["借用(lent)", "价值(value)", "相等(equal)"]
  },
  "example": {
    "title": "点睛之笔",
    "sentence": "In terms of energy, one kilogram of coal is roughly equivalent to 8.14 kilowatt-hours of electricity.",
    "translation": "就能量而言，一千克煤大致相当于 8.14 千瓦时的电。"
  }
}
\`\`\`

【任务上下文】
- 词典释义（JSON或字符串）：${defStr}
- 偏好类型：${type}
${extra}${regen}
`;
}


